<div class="extra-wide-container">
  <mat-card class="admin-card">
    <mat-card-header>
      <mat-card-title>Admin Panel</mat-card-title>
      <mat-card-subtitle>Manage user roles and permissions</mat-card-subtitle>
    </mat-card-header>

    <mat-divider class="divider"></mat-divider>

    <mat-card-content>
      <!-- User Role Management Section -->
      <div class="admin-section">
        <h3>User Role Management</h3>
        
        <div class="role-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>User Email</mat-label>
            <input
              matInput
              type="email"
              [(ngModel)]="userEmail"
              placeholder="user@example.com"
            >
            <mat-icon matPrefix>email</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Role</mat-label>
            <mat-select [(ngModel)]="selectedRole">
              <mat-option value="Admin">Admin</mat-option>
              <mat-option value="User">User</mat-option>
            </mat-select>
            <mat-icon matPrefix>security</mat-icon>
          </mat-form-field>

          <div class="form-actions">
            <button
              matButton="filled"
              color="primary"
              (click)="addRoleToUser()"
              [disabled]="!userEmail || isLoading"
            >
              @if (isLoading) {
                Adding...
              } @else {
                Add Role
              }
            </button>

            <button
              matButton="filled"
              color="warn"
              (click)="removeRoleFromUser()"
              [disabled]="!userEmail || isLoading"
            >
              @if (isLoading) {
                Removing...
              } @else {
                Remove Role
              }
            </button>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>

      <!-- Users List Section -->
      <div class="admin-section">
        <div class="section-header">
          <h3>All Users</h3>
          <button 
            matButton="filled" 
            color="primary" 
            (click)="loadUsers()" 
            [disabled]="isLoadingUsers"
          >
            @if (isLoadingUsers) {
              Loading...
            } @else {
              Refresh Users
            }
          </button>
        </div>

        @if (users.length > 0) {
          <div class="users-table-container">
            <table mat-table [dataSource]="users" class="mat-elevation-z2">
              <ng-container matColumnDef="userName">
                <th mat-header-cell *matHeaderCellDef>Username</th>
                <td mat-cell *matCellDef="let user">{{ user.userName || 'N/A' }}</td>
              </ng-container>

              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef>Email</th>
                <td mat-cell *matCellDef="let user">{{ user.email || 'N/A' }}</td>
              </ng-container>

              <ng-container matColumnDef="roles">
                <th mat-header-cell *matHeaderCellDef>Roles</th>
                <td mat-cell *matCellDef="let user">
                  <div class="roles-cell">
                    @for (role of user.roles; track role) {
                      <mat-chip color="primary" selected>{{ role }}</mat-chip>
                    }
                  </div>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>
        }
      </div>

      <mat-divider></mat-divider>

      <!-- Roles List Section -->
      <div class="admin-section">
        <div class="section-header">
          <h3>Available Roles</h3>
          <button 
            matButton="filled" 
            color="primary" 
            (click)="loadRoles()" 
            [disabled]="isLoadingRoles"
          >
            @if (isLoadingRoles) {
              Loading...
            } @else {
              Refresh Roles
            }
          </button>
        </div>
        
        @if (roles.length > 0) {
          <div class="roles-list">
            @for (role of roles; track role) {
              <mat-chip color="accent" selected class="role-chip-large">
                {{ role }}
              </mat-chip>
            }
          </div>
        }
      </div>
    </mat-card-content>
  </mat-card>
</div>